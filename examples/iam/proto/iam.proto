syntax = "proto3";

package iam;

import "synapse/graphql/options.proto";
import "synapse/grpc/options.proto";
import "synapse/storage/options.proto";

// Entity definitions
import "iam.entities.proto";

// Auto-generated types (filters, connections, edges, PageInfo, OrderDirection)
import "iam.synapse.proto";

// =============================================================================
// Request/Response Messages
// =============================================================================

// User service messages
message GetUserRequest {
  int64 id = 1;
}

message GetUserResponse {
  User user = 1;
}

message GetUserByEmailRequest {
  option (synapse.graphql.message) = { input_type: true };
  string email = 1;
}

message ListUsersRequest {
  optional string after = 1;
  optional string before = 2;
  optional int32 first = 3;
  optional int32 last = 4;
  optional UserFilter filter = 5;
  optional UserOrderBy order_by = 6;
}

message CreateUserRequest {
  string email = 1;
  string name = 2;
  optional string avatar_url = 3;
  optional int64 organization_id = 4;
}

message CreateUserResponse {
  User user = 1;
}

message UpdateUserRequest {
  int64 id = 1;
  optional string email = 2;
  optional string name = 3;
  optional string avatar_url = 4;
  optional int64 organization_id = 5;
  optional bool is_active = 6;
}

message UpdateUserResponse {
  User user = 1;
}

message DeleteUserRequest {
  int64 id = 1;
}

message DeleteUserResponse {
  bool success = 1;
}

// Organization service messages
message GetOrganizationRequest {
  int64 id = 1;
}

message GetOrganizationResponse {
  Organization organization = 1;
}

message GetOrganizationBySlugRequest {
  option (synapse.graphql.message) = { input_type: true };
  string slug = 1;
}

message ListOrganizationsRequest {
  optional string after = 1;
  optional string before = 2;
  optional int32 first = 3;
  optional int32 last = 4;
  optional OrganizationFilter filter = 5;
  optional OrganizationOrderBy order_by = 6;
}

message CreateOrganizationRequest {
  string name = 1;
  string slug = 2;
  optional string description = 3;
}

message CreateOrganizationResponse {
  Organization organization = 1;
}

message UpdateOrganizationRequest {
  int64 id = 1;
  optional string name = 2;
  optional string slug = 3;
  optional string description = 4;
}

message UpdateOrganizationResponse {
  Organization organization = 1;
}

message DeleteOrganizationRequest {
  int64 id = 1;
}

message DeleteOrganizationResponse {
  bool success = 1;
}

// Team service messages
message GetTeamRequest {
  int64 id = 1;
}

message GetTeamResponse {
  Team team = 1;
}

message ListTeamsRequest {
  optional string after = 1;
  optional string before = 2;
  optional int32 first = 3;
  optional int32 last = 4;
  optional TeamFilter filter = 5;
  optional TeamOrderBy order_by = 6;
}

message CreateTeamRequest {
  string name = 1;
  string slug = 2;
  optional string description = 3;
  int64 organization_id = 4;
}

message CreateTeamResponse {
  Team team = 1;
}

message UpdateTeamRequest {
  int64 id = 1;
  optional string name = 2;
  optional string slug = 3;
  optional string description = 4;
}

message UpdateTeamResponse {
  Team team = 1;
}

message DeleteTeamRequest {
  int64 id = 1;
}

message DeleteTeamResponse {
  bool success = 1;
}

// Team membership
message AddTeamMemberRequest {
  option (synapse.graphql.message) = { input_type: true };
  int64 team_id = 1;
  int64 user_id = 2;
  string role = 3;
}

message AddTeamMemberResponse {
  bool success = 1;
}

message RemoveTeamMemberRequest {
  option (synapse.graphql.message) = { input_type: true };
  int64 team_id = 1;
  int64 user_id = 2;
}

message RemoveTeamMemberResponse {
  bool success = 1;
}

// =============================================================================
// Services
// =============================================================================

service UserService {
  option (synapse.graphql.service) = {};
  option (synapse.grpc.service) = {};
  option (synapse.storage.service) = {
    generate_storage: true
    generate_implementation: true
  };

  // Queries
  rpc GetUser(GetUserRequest) returns (GetUserResponse) {
    option (synapse.graphql.method) = {
      name: "user"
      description: "Get a user by ID"
      operation: "Query"
      output_type: "User"
      output_field: "user"
    };
  }

  // GetUserByEmail removed - requires custom implementation
  // TODO: Add support for non-standard lookup patterns

  rpc ListUsers(ListUsersRequest) returns (UserConnection) {
    option (synapse.graphql.method) = {
      name: "users"
      description: "List users with pagination"
      operation: "Query"
    };
  }

  // Mutations
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse) {
    option (synapse.graphql.method) = {
      name: "createUser"
      description: "Create a new user"
      operation: "Mutation"
      output_type: "User"
      output_field: "user"
    };
  }

  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse) {
    option (synapse.graphql.method) = {
      name: "updateUser"
      description: "Update an existing user"
      operation: "Mutation"
      output_type: "User"
      output_field: "user"
    };
  }

  rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse) {
    option (synapse.graphql.method) = {
      name: "deleteUser"
      description: "Delete a user"
      operation: "Mutation"
    };
  }
}

service OrganizationService {
  option (synapse.graphql.service) = {};
  option (synapse.grpc.service) = {};
  option (synapse.storage.service) = {
    generate_storage: true
    generate_implementation: true
  };

  // Queries
  rpc GetOrganization(GetOrganizationRequest) returns (GetOrganizationResponse) {
    option (synapse.graphql.method) = {
      name: "organization"
      description: "Get an organization by ID"
      operation: "Query"
      output_type: "Organization"
      output_field: "organization"
    };
  }

  // GetOrganizationBySlug removed - requires custom implementation
  // TODO: Add support for non-standard lookup patterns

  rpc ListOrganizations(ListOrganizationsRequest) returns (OrganizationConnection) {
    option (synapse.graphql.method) = {
      name: "organizations"
      description: "List organizations with pagination"
      operation: "Query"
    };
  }

  // Mutations
  rpc CreateOrganization(CreateOrganizationRequest) returns (CreateOrganizationResponse) {
    option (synapse.graphql.method) = {
      name: "createOrganization"
      description: "Create a new organization"
      operation: "Mutation"
      output_type: "Organization"
      output_field: "organization"
    };
  }

  rpc UpdateOrganization(UpdateOrganizationRequest) returns (UpdateOrganizationResponse) {
    option (synapse.graphql.method) = {
      name: "updateOrganization"
      description: "Update an existing organization"
      operation: "Mutation"
      output_type: "Organization"
      output_field: "organization"
    };
  }

  rpc DeleteOrganization(DeleteOrganizationRequest) returns (DeleteOrganizationResponse) {
    option (synapse.graphql.method) = {
      name: "deleteOrganization"
      description: "Delete an organization"
      operation: "Mutation"
    };
  }
}

service TeamService {
  option (synapse.graphql.service) = {};
  option (synapse.grpc.service) = {};
  option (synapse.storage.service) = {
    generate_storage: true
    generate_implementation: true
  };

  // Queries
  rpc GetTeam(GetTeamRequest) returns (GetTeamResponse) {
    option (synapse.graphql.method) = {
      name: "team"
      description: "Get a team by ID"
      operation: "Query"
      output_type: "Team"
      output_field: "team"
    };
  }

  rpc ListTeams(ListTeamsRequest) returns (TeamConnection) {
    option (synapse.graphql.method) = {
      name: "teams"
      description: "List teams with pagination"
      operation: "Query"
    };
  }

  // Mutations
  rpc CreateTeam(CreateTeamRequest) returns (CreateTeamResponse) {
    option (synapse.graphql.method) = {
      name: "createTeam"
      description: "Create a new team"
      operation: "Mutation"
      output_type: "Team"
      output_field: "team"
    };
  }

  rpc UpdateTeam(UpdateTeamRequest) returns (UpdateTeamResponse) {
    option (synapse.graphql.method) = {
      name: "updateTeam"
      description: "Update an existing team"
      operation: "Mutation"
      output_type: "Team"
      output_field: "team"
    };
  }

  rpc DeleteTeam(DeleteTeamRequest) returns (DeleteTeamResponse) {
    option (synapse.graphql.method) = {
      name: "deleteTeam"
      description: "Delete a team"
      operation: "Mutation"
    };
  }

  // AddTeamMember removed - requires custom implementation with join table
  // TODO: Add support for many-to-many mutations

  // RemoveTeamMember removed - requires custom implementation with join table
  // TODO: Add support for many-to-many mutations
}
