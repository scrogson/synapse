// Example: User and Post entities with Synapse annotations
//
// This demonstrates flat protobuf messages with relations defined as
// message-level options. The proto wire format stays flat while code
// generation uses relation metadata to:
// - Generate SeaORM relation methods
// - Generate GraphQL nested schemas with dataloaders
// - Keep gRPC flat with batch-fetchable IDs

syntax = "proto3";

package example;

import "synapse/storage/options.proto";
import "synapse/graphql/options.proto";
import "google/protobuf/timestamp.proto";

// User entity - flat proto, relations defined in options
message User {
  option (synapse.storage.entity) = {
    table_name: "users"
    relations: [
      {
        name: "posts"
        type: RELATION_TYPE_HAS_MANY
        related: "Post"
        foreign_key: "author_id"
      }
    ]
  };

  int64 id = 1 [(synapse.storage.column) = {
    primary_key: true
  }];

  string email = 2 [(synapse.storage.column) = {
    unique: true
  }];

  string name = 3;

  optional string bio = 4;

  UserStatus status = 5;

  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;

  // No embedded posts field - gRPC returns flat data
  // GraphQL generates: user { posts { id title } } from relation options
}

// Post entity - flat proto, relations defined in options
message Post {
  option (synapse.storage.entity) = {
    table_name: "posts"
    relations: [
      {
        name: "author"
        type: RELATION_TYPE_BELONGS_TO
        related: "User"
        foreign_key: "author_id"
        references: "id"
      }
    ]
  };

  int64 id = 1 [(synapse.storage.column) = {
    primary_key: true
  }];

  string title = 2;
  string content = 3;

  // FK column - needed for storage/gRPC, hidden from GraphQL
  int64 author_id = 4 [(synapse.graphql.field) = { skip: true }];

  google.protobuf.Timestamp created_at = 5;
  google.protobuf.Timestamp updated_at = 6;

  // No embedded author field - gRPC returns flat data with author_id
  // GraphQL generates: post { author { id name } } from relation options
}

// Status enum stored as string in database
enum UserStatus {
  option (synapse.storage.enum_storage) = {
    db_type: ENUM_DB_TYPE_STRING
  };

  USER_STATUS_UNSPECIFIED = 0;
  USER_STATUS_ACTIVE = 1 [(synapse.storage.enum_value_storage) = {
    string_value: "active"
  }];
  USER_STATUS_INACTIVE = 2 [(synapse.storage.enum_value_storage) = {
    string_value: "inactive"
  }];
  USER_STATUS_BANNED = 3 [(synapse.storage.enum_value_storage) = {
    string_value: "banned"
  }];
}
