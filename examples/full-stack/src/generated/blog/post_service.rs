//!gRPC service implementation for PostService
//!
//! Generated by protoc-gen-synapse from protobuf service definition.
//! @generated
#![allow(missing_docs)]
#![allow(unused_imports)]
use super::prelude::*;
use super::post_service_storage::{PostServiceStorage, StorageError};
use tonic::{Request, Response, Status};
/// Validation error for request field failures
#[derive(Debug, thiserror::Error)]
pub enum ValidationError {
    /// A field failed validation
    #[error("Invalid field '{field}': {message}")]
    InvalidField {
        /// The field that failed validation
        field: String,
        /// Description of the validation failure
        message: String,
    },
    /// A required field was missing
    #[error("Missing required field: {0}")]
    MissingRequired(String),
}
/// Service-level error wrapping validation and storage errors
#[derive(Debug, thiserror::Error)]
pub enum ServiceError {
    /// Request validation failed
    #[error("Validation failed: {0}")]
    Validation(#[from] ValidationError),
    /// Storage operation failed
    #[error("Storage error: {0}")]
    Storage(#[from] StorageError),
}
impl From<ServiceError> for tonic::Status {
    fn from(e: ServiceError) -> Self {
        match e {
            ServiceError::Validation(v) => tonic::Status::invalid_argument(v.to_string()),
            ServiceError::Storage(s) => {
                match s {
                    StorageError::NotFound(msg) => tonic::Status::not_found(msg),
                    StorageError::Database(db_err) => {
                        tonic::Status::internal(db_err.to_string())
                    }
                    StorageError::InvalidArgument(msg) => {
                        tonic::Status::invalid_argument(msg)
                    }
                }
            }
        }
    }
}
///gRPC service wrapper for PostService that delegates to PostServiceStorage
pub struct PostServiceGrpcService<S: PostServiceStorage + 'static> {
    storage: S,
}
impl<S: PostServiceStorage + 'static> PostServiceGrpcService<S> {
    /// Create a new gRPC service with the given storage implementation
    pub fn new(storage: S) -> Self {
        Self { storage }
    }
    /// Get a reference to the underlying storage
    pub fn storage(&self) -> &S {
        &self.storage
    }
    /// Get a mutable reference to the underlying storage
    pub fn storage_mut(&mut self) -> &mut S {
        &mut self.storage
    }
    /// Consume the service and return the storage
    pub fn into_storage(self) -> S {
        self.storage
    }
}
#[tonic::async_trait]
impl<S: PostServiceStorage + 'static> post_service_server::PostService
for PostServiceGrpcService<S> {
    async fn get_post(
        &self,
        request: Request<GetPostRequest>,
    ) -> Result<Response<GetPostResponse>, Status> {
        self.storage
            .get_post(request.into_inner())
            .await
            .map(Response::new)
            .map_err(|e| tonic::Status::from(ServiceError::Storage(e)))
    }
    async fn list_posts(
        &self,
        request: Request<ListPostsRequest>,
    ) -> Result<Response<PostConnection>, Status> {
        self.storage
            .list_posts(request.into_inner())
            .await
            .map(Response::new)
            .map_err(|e| tonic::Status::from(ServiceError::Storage(e)))
    }
    async fn create_post(
        &self,
        request: Request<CreatePostRequest>,
    ) -> Result<Response<CreatePostResponse>, Status> {
        self.storage
            .create_post(request.into_inner())
            .await
            .map(Response::new)
            .map_err(|e| tonic::Status::from(ServiceError::Storage(e)))
    }
    async fn update_post(
        &self,
        request: Request<UpdatePostRequest>,
    ) -> Result<Response<UpdatePostResponse>, Status> {
        self.storage
            .update_post(request.into_inner())
            .await
            .map(Response::new)
            .map_err(|e| tonic::Status::from(ServiceError::Storage(e)))
    }
    async fn delete_post(
        &self,
        request: Request<DeletePostRequest>,
    ) -> Result<Response<DeletePostResponse>, Status> {
        self.storage
            .delete_post(request.into_inner())
            .await
            .map(Response::new)
            .map_err(|e| tonic::Status::from(ServiceError::Storage(e)))
    }
}
