//! Conversions between proto types and SeaORM entities
//!
//! This module is auto-generated by build.rs

#![allow(missing_docs)]
#![allow(unused_imports)]

use super::prelude::*;
use super::{user, post};
use sea_orm::ActiveValue::Set;

// ============================================================================
// User conversions
// ============================================================================

/// Convert SeaORM User Model to proto User
impl From<user::Model> for User {
    fn from(model: user::Model) -> Self {
        Self {
            id: model.id,
            email: model.email,
            name: model.name,
            bio: model.bio,
            created_at: Some(prost_types::Timestamp {
                seconds: model.created_at.timestamp(),
                nanos: model.created_at.timestamp_subsec_nanos() as i32,
            }),
            updated_at: Some(prost_types::Timestamp {
                seconds: model.updated_at.timestamp(),
                nanos: model.updated_at.timestamp_subsec_nanos() as i32,
            }),
        }
    }
}

/// Convert CreateUserInput to SeaORM ActiveModel
impl From<CreateUserInput> for user::ActiveModel {
    fn from(input: CreateUserInput) -> Self {
        Self {
            email: Set(input.email),
            name: Set(input.name),
            bio: Set(input.bio),
            ..Default::default()
        }
    }
}

/// Extension trait for applying updates to an active model
pub trait ApplyUpdate<T> {
    fn apply_update(&mut self, input: T);
}

/// Apply UpdateUserInput to User ActiveModel
impl ApplyUpdate<UpdateUserInput> for user::ActiveModel {
    fn apply_update(&mut self, input: UpdateUserInput) {
        if let Some(email) = input.email {
            self.email = Set(email);
        }
        if let Some(name) = input.name {
            self.name = Set(name);
        }
        if let Some(bio) = input.bio {
            self.bio = Set(Some(bio));
        }
    }
}

// ============================================================================
// Post conversions
// ============================================================================

/// Convert SeaORM Post Model to proto Post
impl From<post::Model> for Post {
    fn from(model: post::Model) -> Self {
        Self {
            id: model.id,
            title: model.title,
            content: model.content,
            published: model.published,
            author_id: model.author_id,
            created_at: Some(prost_types::Timestamp {
                seconds: model.created_at.timestamp(),
                nanos: model.created_at.timestamp_subsec_nanos() as i32,
            }),
            updated_at: Some(prost_types::Timestamp {
                seconds: model.updated_at.timestamp(),
                nanos: model.updated_at.timestamp_subsec_nanos() as i32,
            }),
        }
    }
}

/// Convert CreatePostInput to SeaORM ActiveModel
impl From<CreatePostInput> for post::ActiveModel {
    fn from(input: CreatePostInput) -> Self {
        Self {
            title: Set(input.title),
            content: Set(input.content),
            published: Set(input.published),
            author_id: Set(input.author_id),
            ..Default::default()
        }
    }
}

/// Apply UpdatePostInput to Post ActiveModel
impl ApplyUpdate<UpdatePostInput> for post::ActiveModel {
    fn apply_update(&mut self, input: UpdatePostInput) {
        if let Some(title) = input.title {
            self.title = Set(title);
        }
        if let Some(content) = input.content {
            self.content = Set(content);
        }
        if let Some(published) = input.published {
            self.published = Set(published);
        }
    }
}
