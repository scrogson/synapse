syntax = "proto3";

package blog;

import "synapse/graphql/options.proto";
import "synapse/grpc/options.proto";
import "synapse/storage/options.proto";

// Entity definitions
import "blog.entities.proto";

// Auto-generated types (filters, connections, edges, PageInfo, OrderDirection)
import "blog.synapse.proto";

// =============================================================================
// Request/Response Messages
// =============================================================================

// User service messages
message GetUserRequest {
  int64 id = 1;
}

message GetUserResponse {
  User user = 1;
}

message ListUsersRequest {
  // Relay pagination
  optional string after = 1;
  optional string before = 2;
  optional int32 first = 3;
  optional int32 last = 4;
  // Filter & ordering
  optional UserFilter filter = 5;
  optional UserOrderBy order_by = 6;
}

message CreateUserRequest {
  string email = 1;
  string name = 2;
  optional string bio = 3;
}

message CreateUserResponse {
  User user = 1;
}

message UpdateUserRequest {
  int64 id = 1;
  optional string email = 2;
  optional string name = 3;
  optional string bio = 4;
}

message UpdateUserResponse {
  User user = 1;
}

message DeleteUserRequest {
  int64 id = 1;
}

message DeleteUserResponse {
  bool success = 1;
}

// Post service messages
message GetPostRequest {
  int64 id = 1;
}

message GetPostResponse {
  Post post = 1;
}

message ListPostsRequest {
  // Relay pagination
  optional string after = 1;
  optional string before = 2;
  optional int32 first = 3;
  optional int32 last = 4;
  // Filter & ordering
  optional PostFilter filter = 5;
  optional PostOrderBy order_by = 6;
}

message CreatePostRequest {
  string title = 1;
  string content = 2;
  bool published = 3;
  int64 author_id = 4;
}

message CreatePostResponse {
  Post post = 1;
}

message UpdatePostRequest {
  int64 id = 1;
  optional string title = 2;
  optional string content = 3;
  optional bool published = 4;
  optional int64 author_id = 5;
}

message UpdatePostResponse {
  Post post = 1;
}

message DeletePostRequest {
  int64 id = 1;
}

message DeletePostResponse {
  bool success = 1;
}

// =============================================================================
// Services
// =============================================================================

service UserService {
  option (synapse.graphql.service) = {};
  option (synapse.grpc.service) = {};
  option (synapse.storage.service) = {
    generate_storage: true
    generate_implementation: true
  };

  // Queries
  rpc GetUser(GetUserRequest) returns (GetUserResponse) {
    option (synapse.graphql.method) = {
      name: "user"
      description: "Get a user by ID"
      operation: "Query"
      output_type: "User"
      output_field: "user"
    };
  }

  rpc ListUsers(ListUsersRequest) returns (UserConnection) {
    option (synapse.graphql.method) = {
      name: "users"
      description: "List users with pagination"
      operation: "Query"
    };
  }

  // Mutations
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse) {
    option (synapse.graphql.method) = {
      name: "createUser"
      description: "Create a new user"
      operation: "Mutation"
      output_type: "User"
      output_field: "user"
    };
  }

  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse) {
    option (synapse.graphql.method) = {
      name: "updateUser"
      description: "Update an existing user"
      operation: "Mutation"
      output_type: "User"
      output_field: "user"
    };
  }

  rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse) {
    option (synapse.graphql.method) = {
      name: "deleteUser"
      description: "Delete a user"
      operation: "Mutation"
    };
  }
}

service PostService {
  option (synapse.graphql.service) = {};
  option (synapse.grpc.service) = {};
  option (synapse.storage.service) = {
    generate_storage: true
    generate_implementation: true
  };

  // Queries
  rpc GetPost(GetPostRequest) returns (GetPostResponse) {
    option (synapse.graphql.method) = {
      name: "post"
      description: "Get a post by ID"
      operation: "Query"
      output_type: "Post"
      output_field: "post"
    };
  }

  rpc ListPosts(ListPostsRequest) returns (PostConnection) {
    option (synapse.graphql.method) = {
      name: "posts"
      description: "List posts with pagination"
      operation: "Query"
    };
  }

  // Mutations
  rpc CreatePost(CreatePostRequest) returns (CreatePostResponse) {
    option (synapse.graphql.method) = {
      name: "createPost"
      description: "Create a new post"
      operation: "Mutation"
      output_type: "Post"
      output_field: "post"
    };
  }

  rpc UpdatePost(UpdatePostRequest) returns (UpdatePostResponse) {
    option (synapse.graphql.method) = {
      name: "updatePost"
      description: "Update an existing post"
      operation: "Mutation"
      output_type: "Post"
      output_field: "post"
    };
  }

  rpc DeletePost(DeletePostRequest) returns (DeletePostResponse) {
    option (synapse.graphql.method) = {
      name: "deletePost"
      description: "Delete a post"
      operation: "Mutation"
    };
  }
}
