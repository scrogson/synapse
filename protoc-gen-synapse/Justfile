# protoc-gen-synapse Justfile

# Default recipe
default: build

# Build in debug mode
build:
    cargo build

# Build in release mode
build-release:
    cargo build --release

# Run tests
test:
    cargo test

# Check for errors without building
check:
    cargo check

# Run clippy lints
lint:
    cargo clippy -- -D warnings

# Format code
fmt:
    cargo fmt

# Format check (for CI)
fmt-check:
    cargo fmt -- --check

# Generate test output from fixtures
generate: build-release
    rm -rf tests/output/*
    protoc \
        --plugin=protoc-gen-synapse=./target/release/protoc-gen-synapse \
        --synapse_out=backend=seaorm:tests/output \
        -I../proto \
        -Itests/fixtures \
        tests/fixtures/user_service.proto \
        tests/fixtures/user.proto

# Generate with debug output
generate-debug: build-release
    rm -rf tests/output/*
    SEAORM_DEBUG=1 protoc \
        --plugin=protoc-gen-synapse=./target/release/protoc-gen-synapse \
        --synapse_out=backend=seaorm:tests/output \
        -I../proto \
        -Itests/fixtures \
        tests/fixtures/user_service.proto

# Clean build artifacts
clean:
    cargo clean
    rm -rf tests/output/*

# Full CI check
ci: fmt-check lint test

# Watch for changes and rebuild
watch:
    cargo watch -x build

# Show generated files
show-output:
    find tests/output -name "*.rs" -exec echo "=== {} ===" \; -exec cat {} \;
